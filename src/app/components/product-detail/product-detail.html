<!-- Back Button -->
<div class="back-button-container">
  <button class="btn btn-outline-primary back-button" (click)="goBack()">
    <i class="fas fa-arrow-left me-2"></i> Regresar
  </button>
</div>

<div class="modern-container" *ngIf="product">
  <div class="product-card">
    <div class="row g-4">
      <!-- Image Section -->
      <div class="col-lg-6">
        <div class="image-section">
          <!-- Main Image -->
          <div class="main-image-container">
            <div id="productCarousel" class="carousel slide" data-bs-ride="carousel" (slid)="onCarouselSlide($event)">
              <div class="carousel-inner">
                <div
                  *ngFor="let image of product.imageUrl; let i = index"
                  class="carousel-item"
                  [class.active]="i === selectedImageIndex"
                >
                  <img
                    [src]="image"
                    class="d-block w-100 main-image"
                    [alt]="product.name + ' image ' + (i + 1)"
                    (click)="openModal(i)"
                  />
                </div>
              </div>
              <button
                class="carousel-control-prev"
                type="button"
                data-bs-target="#productCarousel"
                data-bs-slide="prev"
                (click)="selectImage((selectedImageIndex - 1 + product.imageUrl.length) % product.imageUrl.length)"
              >
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button
                class="carousel-control-next"
                type="button"
                data-bs-target="#productCarousel"
                data-bs-slide="next"
                (click)="selectImage((selectedImageIndex + 1) % product.imageUrl.length)"
              >
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
          </div>

          <!-- Thumbnail Navigation -->
          <div class="thumbnail-container">
            <div class="d-flex gap-2 justify-content-center mt-3">
              <button
                *ngFor="let image of product.imageUrl; let i = index"
                type="button"
                class="thumbnail-btn"
                [class.active]="i === selectedImageIndex"
                (click)="selectImage(i)"
              >
                <img
                  [src]="image"
                  class="thumbnail-img"
                  [alt]="'Thumbnail ' + (i + 1)"
                />
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Product Info Section -->
      <div class="col-lg-6">
        <div class="product-info">
          <div class="product-header">
            <h1 class="product-title">{{ product.name }}</h1>
            <div class="product-meta">
              <span class="badge bg-primary me-2">{{ product.brand.name }}</span>
              <span class="badge bg-secondary">{{ product.model }}</span>
            </div>
          </div>

          <div class="product-details">
            <div class="detail-row">
              <span class="detail-label">SKU:</span>
              <span class="detail-value">{{ product.code }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Categorías:</span>
              <span class="detail-value">{{ product.category.join(', ') }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Disponible:</span>
              <span class="detail-value" [class.text-danger]="product.quantity <= 0">
                {{ product.quantity }} unidades
              </span>
            </div>
          </div>

          <div class="price-section">
            <div class="price-tag">
              <span class="currency">Q</span>
              <span class="amount">{{ product.price | number: '1.2-2' }}</span>
            </div>
          </div>

          <div class="description-section">
            <h4 class="section-title">Descripción</h4>
            <p class="description">{{ product.description }}</p>
          </div>

          <div class="action-buttons">
            <button
              class="btn btn-primary btn-lg add-to-cart-btn"
              (click)="addToCart()"
              [disabled]="product.quantity <= 0"
            >
              <i class="fas fa-cart-plus me-2"></i>
              Agregar al Carrito
            </button>
            <button
              class="btn btn-outline-secondary btn-lg favorites-btn"
              (click)="toggleFavorite()"
              [class.btn-danger]="isFavorite()"
              [class.btn-outline-secondary]="!isFavorite()"
            >
              <i class="fas fa-heart me-2" [class.text-white]="isFavorite()"></i>
              {{ isFavorite() ? 'En Favoritos' : 'Agregar a Favoritos' }}
            </button>
          </div>

          <div *ngIf="product.quantity <= 0" class="out-of-stock">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span>Producto agotado</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container mt-5" *ngIf="!product">
  <div class="alert alert-info text-center">
    <h4>Cargando producto...</h4>
  </div>
</div>

<!-- Modal para imagen ampliada -->
<div class="modal fade" tabindex="-1" [ngClass]="{'show d-block': showModal}" [style.backgroundColor]="'rgba(0,0,0,0.8)'" (click)="closeModal()" *ngIf="product">
  <div class="modal-dialog modal-dialog-centered modal-lg" (click)="$event.stopPropagation()">
    <div class="modal-content bg-transparent border-0">
      <div class="carousel-indicators">
        <button
          *ngFor="let image of product.imageUrl; let i = index"
          type="button"
          [attr.data-bs-target]="'#carouselExampleCaptions'"
          [attr.data-bs-slide-to]="i"
          [class.active]="i === modalImageIndex"
          aria-current="true"
          [attr.aria-label]="'Slide ' + (i + 1)"
        ></button>
      </div>
      <div class="modal-body p-0 position-relative">
        <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3" aria-label="Close" (click)="closeModal()"></button>
        <img [src]="modalImage" class="img-fluid" style="max-width: 100%;" alt="Imagen ampliada" />

        <button class="carousel-control-prev position-absolute start-0" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev" (click)="prevModalImage()">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next position-absolute end-0" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next" (click)="nextModalImage()">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Siguiente</span>
        </button>
      </div>
    </div>
  </div>
</div>
